ivita</span>
      </a>
      <a href="#contatti">
        <svg><use href="#q-map"/></svg>
        <span data-i18n="contacts">Contatti</span>
      </a>
    </nav>
  </div>
  <a href="https://wa.me/393470839898" class="whatsapp-widget" target="_blank" rel="noopener noreferrer" aria-label="Contattaci su WhatsApp">
    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <path fill="white" d="M16 0c-8.837 0-16 7.163-16 16 0 2.825.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-.646-7.07-1.87l-.507-.292-5.247 1.408 1.417-5.267-.321-.525c-1.321-2.165-2.005-4.652-2.005-7.188 0-7.51 6.11-13.62 13.62-13.62s13.62 6.11 13.62 13.62-6.11 13.62-13.62 13.62zM21.305 18.421c-.327-.163-1.933-.956-2.233-1.066s-.518-.163-.736.163c-.218.327-.845 1.066-1.036 1.284s-.382.245-.709.082c-.327-.163-1.381-.509-2.632-1.626-.973-.868-1.629-1.939-1.82-2.267s-.02-.504.143-.667c.147-.146.327-.382.491-.573s.218-.327.327-.545c.109-.218.055-.409-.027-.573s-.736-1.775-1.01-2.43c-.267-.638-.538-.552-.736-.562-.191-.01-.409-.012-.627-.012s-.573.082-.873.409c-.3.327-1.145 1.12-1.145 2.731s1.172 3.167 1.336 3.385c.163.218 2.312 3.527 5.602 4.945.782.337 1.393.539 1.869.689.787.25 1.503.215 2.069.13.631-.094 1.933-.791 2.207-1.555s.273-1.42.191-1.555c-.082-.135-.3-.218-.627-.382z"/>
    </svg>
  </a>
  <script>
  const TRANSLATIONS = {
    it: {
      'house':'La casa','house-desc':'TV, clima, riscaldamento','eat':'Mangiare','eat-desc':'Ristoranti locali',
      'activities':'Attività','activities-desc':'Esperienze e svago','wifi':'Wi-Fi','password':'Password',
      'copy-password':'Copia password','copied':'Copiata ✅','checkin-checkout':'Check-in / Check-out',
      'checkin':'Check-in','checkout':'Check-out','host':'Host','house-rules':'Regole della casa',
      'emergencies':'Emergenze','house-operations':'Funzionamento della casa','where-eat':'Dove mangiare',
      'recommended-activities':'Attività consigliate','gallery':'Galleria','contacts':'Contatti','map':'Mappa',
      'maps':'Maps','call':'Chiama','home':'Home','filter-all':'Tutti','filter-nearby':'Vicino',
      'leave-feedback':'Lascia un feedback','address':'Indirizzo','thank-you':'Grazie per aver scelto la nostra guida digitale',
      'essential-services':'Servizi Essenziali','pharmacies':'Farmacie','supermarkets':'Supermercati',
      'outdoor':'All\'aperto','indoor':'Al chiuso','powered-by':'Gentilmente powered by QRelax','show-services':'Mostra servizi'
    },
    en: {
      'house':'The house','house-desc':'TV, air conditioning, heating','eat':'Dining','eat-desc':'Local restaurants',
      'activities':'Activities','activities-desc':'Experiences and entertainment','wifi':'Wi-Fi','password':'Password',
      'copy-password':'Copy password','copied':'Copied ✅','checkin-checkout':'Check-in / Check-out',
      'checkin':'Check-in','checkout':'Check-out','host':'Host','house-rules':'House rules',
      'emergencies':'Emergencies','house-operations':'How the house works','where-eat':'Where to eat',
      'recommended-activities':'Recommended activities','gallery':'Gallery','contacts':'Contacts','map':'Map',
      'maps':'Maps','call':'Call','home':'Home','filter-all':'All','filter-nearby':'Nearby',
      'leave-feedback':'Leave feedback','address':'Address','thank-you':'Thank you for choosing our digital guide',
      'essential-services':'Essential Services','pharmacies':'Pharmacies','supermarkets':'Supermarkets',
      'outdoor':'Outdoor','indoor':'Indoor','powered-by':'Kindly powered by QRelax','show-services':'Show services'
    },
    de: {
      'house':'Das Haus','house-desc':'TV, Klimaanlage, Heizung','eat':'Essen','eat-desc':'Lokale Restaurants',
      'activities':'Aktivitäten','activities-desc':'Erlebnisse und Unterhaltung','wifi':'Wi-Fi','password':'Passwort',
      'copy-password':'Passwort kopieren','copied':'Kopiert ✅','checkin-checkout':'Check-in / Check-out',
      'checkin':'Check-in','checkout':'Check-out','host':'Gastgeber','house-rules':'Hausregeln',
      'emergencies':'Notfälle','house-operations':'Wie das Haus funktioniert','where-eat':'Wo man essen kann',
      'recommended-activities':'Empfohlene Aktivitäten','gallery':'Galerie','contacts':'Kontakte','map':'Karte',
      'maps':'Maps','call':'Anrufen','home':'Home','filter-all':'Alle','filter-nearby':'In der Nähe',
      'leave-feedback':'Feedback hinterlassen','address':'Adresse','thank-you':'Danke, dass Sie unseren digitalen Reiseführer gewählt haben',
      'essential-services':'Wichtige Dienste','pharmacies':'Apotheken','supermarkets':'Supermärkte',
      'outdoor':'Im Freien','indoor':'Innen','powered-by':'Freundlicherweise bereitgestellt von QRelax','show-services':'Dienste anzeigen'
    }
  };
  let currentLang = 'it';
  let apartmentData = null;
  function initTheme() {
    const saved = localStorage.getItem('qrelax-theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = saved || (prefersDark ? 'dark' : 'light');
    setTheme(theme);
  }
  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('qrelax-theme', theme);
    const icon = document.getElementById('theme-icon');
    if (icon) icon.innerHTML = `<use href="#q-${theme === 'dark' ? 'sun' : 'moon'}"/>`;
  }
  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    setTheme(next);
  }
  async function loadWeather(lat, lon, cityName) {
    try {
      const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
      const data = await response.json();
      const widget = document.getElementById('weather-widget');
      const temp = Math.round(data.current_weather.temperature);
      const weatherCode = data.current_weather.weathercode;
      document.getElementById('weather-temp').textContent = `${temp}°C`;
      document.getElementById('weather-desc').textContent = getWeatherDescription(weatherCode);
      document.getElementById('weather-location').textContent = cityName;
      widget.classList.remove('hidden');
    } catch (e) { console.error('Errore meteo:', e); }
  }
  function getWeatherDescription(code) {
    const d = {0:'☀️ Sereno',1:'🌤️ Parzialmente nuvoloso',2:'⛅ Nuvoloso',3:'☁️ Coperto',45:'🌫️ Nebbia',48:'🌫️ Nebbia',51:'🌦️ Pioggia leggera',61:'🌧️ Pioggia',80:'🌦️ Rovesci',95:'⛈️ Temporale'};
    return d[code] || '🌡️ Meteo';
  }
  function filterRestaurants(filter) {
    document.querySelectorAll('#luoghi-wrap article').forEach(card => {
      const price = card.dataset.price;
      const distance = parseInt(card.dataset.distance || '999',10);
      let show = false;
      if (filter === 'all') show = true;
      else if (filter === 'vicino') show = distance <= 10;
      else show = price === filter;
      card.style.display = show ? 'block' : 'none';
    });
  }
  function filterActivities(filter) {
    document.querySelectorAll('#attivita-wrap article').forEach(card => {
      const type = card.dataset.type;
      if (filter === 'all') card.style.display = 'block';
      else card.style.display = type === filter ? 'block' : 'none';
    });
  }
  function filterServices(filter) {
    document.querySelectorAll('#services-wrap article').forEach(card => {
      const type = card.dataset.type;
      if (filter === 'all') card.style.display = 'block';
      else card.style.display = type === filter ? 'block' : 'none';
    });
  }
  function announce(message) {
    const a = document.getElementById('announcer');
    if (!a) return;
    a.textContent = message; setTimeout(()=> a.textContent='', 1000);
  }
  function getApartmentSlug() {
    const p = new URLSearchParams(window.location.search);
    return p.get('apt') || 'papaya';
  }
  async function loadApartmentData(slug) {
    try {
      const r = await fetch(`${slug}.json`);
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      const data = await r.json();
      apartmentData = data; return data;
    } catch(e){ console.error('Errore caricamento dati:', e); showError(); return null; }
  }
  function showError(){ document.getElementById('loading').classList.add('hidden'); document.getElementById('error').classList.remove('hidden'); }
  function showApp(){ document.getElementById('loading').classList.add('hidden'); document.getElementById('app').classList.remove('hidden'); }
  function renderApartment(data) {
    document.getElementById('page-title').textContent = data.nome || 'QRelax';
    document.getElementById('apt-nome').textContent = data.nome || '';
    document.getElementById('apt-indirizzo').textContent = data.indirizzo || '';
    document.getElementById('apt-cover').src = data.foto_copertina || '';
    document.getElementById('wifi-ssid').textContent = data.wifi_ssid || '—';
    document.getElementById('wifi-pass').textContent = data.wifi_password || '—';
    document.getElementById('checkin').textContent = data.checkin || '—';
    document.getElementById('checkout').textContent = data.checkout || '—';
    const hostInfo = document.getElementById('host-info');
    let hostHtml = '';
    if (data.host_telefono) hostHtml += `<a href="tel:${data.host_telefono.replace(/\s/g,'')}">${data.host_telefono}</a>`;
    if (data.host_email) hostHtml += `${hostHtml ? ' • ' : ''}<a href="mailto:${data.host_email}">${data.host_email}</a>`;
    hostInfo.innerHTML = hostHtml || '—';
    document.getElementById('checkin-note').textContent = data.checkin_note || '';
    const regoleContent = data.regole && data.regole[currentLang] ? data.regole[currentLang] : data.regole || '—';
    document.getElementById('regole').innerHTML = regoleContent;
    const emergenzeContent = data.emergenze && data.emergenze[currentLang] ? data.emergenze[currentLang] : data.emergenze || '—';
    document.getElementById('emergenze').innerHTML = emergenzeContent;
    const funzionamentoContent = data.funzionamento && data.funzionamento[currentLang] ? data.funzionamento[currentLang] : data.funzionamento || '—';
    document.getElementById('funzionamento').innerHTML = funzionamentoContent;
    const contactBlock = document.getElementById('contact-block');
    let contactHtml = hostInfo.innerHTML;
    if (data.indirizzo) {
      const addressLabel = TRANSLATIONS[currentLang]['address'];
      contactHtml += `<p style="margin-top:16px"><strong>${addressLabel}:</strong><br>${data.indirizzo}</p>`;
    }
    contactBlock.innerHTML = contactHtml;
    if (data.mappa_embed) document.getElementById('mappa-iframe').src = data.mappa_embed;
    if (data.lat && data.lon) loadWeather(data.lat, data.lon, data.nome);
    renderRestaurants(data.ristoranti || []);
    renderActivities(data.attivita || []);
    renderServices(data.servizi || []);
    renderGallery(data.galleria || []);
  }
  function renderRestaurants(restaurants) {
    const container = document.getElementById('luoghi-wrap');
    container.innerHTML = '';
    restaurants.forEach(r => {
      const distMatch = (r.distanza || '').match(/(\d+)/);
      const distNum = distMatch ? distMatch[1] : '999';
      const desc = r.descrizione && r.descrizione[currentLang] ? r.descrizione[currentLang] : r.descrizione || '';
      const card = document.createElement('article');
      card.className = 'q-card';
      card.dataset.price = r.prezzo || '';
      card.dataset.distance = distNum;
      card.innerHTML = `
        <div class="q-img"><img src="${r.foto || ''}" alt="${r.nome || ''}" loading="lazy"></div>
        <div style="padding:12px">
          <div class="q-title">${r.nome || ''}</div>
          <div class="q-small">
            ${r.prezzo ? `<span class="q-chip">${r.prezzo}</span>` : ''}
            ${r.distanza ? ` • ${r.distanza}` : ''}
          </div>
          <div class="q-small" style="margin-top:6px">${desc}</div>
          <div class="q-cta" style="margin-top:10px">
            ${r.telefono ? `<a class="q-btn" href="tel:${(r.telefono||'').replace(/\s/g,'')}" aria-label="Chiama ${r.nome||''}"><svg class="q-ico q-ico-sm"><use href="#q-phone"/></svg><span data-i18n="call">Chiama</span></a>` : ''}
            ${r.maps ? `<a class="q-btn" href="${r.maps}" target="_blank" rel="noopener noreferrer" aria-label="Maps ${r.nome||''}"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg><span data-i18n="maps">Maps</span></a>` : ''}
          </div>
        </div>`;
      container.appendChild(card);
    });
  }
  function renderActivities(activities) {
    const container = document.getElementById('attivita-wrap');
    container.innerHTML = '';
    activities.forEach(a => {
      const desc = a.descrizione && a.descrizione[currentLang] ? a.descrizione[currentLang] : a.descrizione || '';
      const card = document.createElement('article');
      card.className = 'q-card';
      card.dataset.type = a.tipo || 'outdoor';
      card.innerHTML = `
        <div class="q-img"><img src="${a.foto || ''}" alt="${a.nome || ''}" loading="lazy"></div>
        <div style="padding:12px">
          <div class="q-title">${a.nome || ''}</div>
          <div class="q-small">${a.distanza || ''}</div>
          <div class="q-small" style="margin-top:6px">${desc}</div>
          ${a.maps ? `<div class="q-cta" style="margin-top:10px"><a class="q-btn" href="${a.maps}" target="_blank" rel="noopener noreferrer" aria-label="Maps ${a.nome||''}"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg><span data-i18n="maps">Maps</span></a></div>` : ''}
        </div>`;
      container.appendChild(card);
    });
  }
  function renderServices(services) {
    const container = document.getElementById('services-wrap');
    container.innerHTML = '';
    services.forEach(s => {
      const card = document.createElement('article');
      card.className = 'q-card';
      card.dataset.type = s.tipo || 'pharmacy';
      card.innerHTML = `
        <div style="padding:12px">
          <div class="q-title">${s.nome || ''}</div>
          <div class="q-small">
            ${s.tipo === 'pharmacy' ? '💊' : '🛒'} ${s.distanza || ''}
          </div>
          <div class="q-small" style="margin-top:6px">${s.indirizzo || ''}</div>
          <div class="q-cta" style="margin-top:10px">
            ${s.telefono ? `<a class="q-btn" href="tel:${(s.telefono||'').replace(/\s/g,'')}" aria-label="Chiama ${s.nome||''}"><svg class="q-ico q-ico-sm"><use href="#q-phone"/></svg><span data-i18n="call">Chiama</span></a>` : ''}
            ${s.maps ? `<a class="q-btn" href="${s.maps}" target="_blank" rel="noopener noreferrer" aria-label="Maps ${s.nome||''}"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg><span data-i18n="maps">Maps</span></a>` : ''}
          </div>
        </div>`;
      container.appendChild(card);
    });
  }
  function renderGallery(photos) {
    const container = document.getElementById('gallery-wrap');
    container.innerHTML = '';
    photos.forEach((photo, idx) => {
      const img = document.createElement('div');
      img.className = 'q-card q-img';
      img.innerHTML = `<img src="${photo}" alt="Foto appartamento ${idx + 1}" loading="lazy">`;
      container.appendChild(img);
    });
  }
  function detectLanguage() {
    const saved = localStorage.getItem('qrelax-lang');
    if (saved && TRANSLATIONS[saved]) return saved;
    const browser = navigator.language.slice(0,2);
    return TRANSLATIONS[browser] ? browser : 'it';
  }
  function translatePage(lang) {
    currentLang = lang; 
    localStorage.setItem('qrelax-lang', lang);
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.dataset.i18n;
      if (TRANSLATIONS[lang] && TRANSLATIONS[lang][key]) el.textContent = TRANSLATIONS[lang][key];
    });
    if (apartmentData) renderApartment(apartmentData);
  }
  document.addEventListener('click', (e) => {
    if (e.target && (e.target.id === 'theme-toggle' || e.target.closest('#theme-toggle'))) { 
      e.preventDefault(); toggleTheme(); return; 
    }
    if (e.target && e.target.classList.contains('lang-btn')) { 
      e.preventDefault(); translatePage(e.target.dataset.lang); return; 
    }
    if (e.target && e.target.classList.contains('filter-btn')) {
      const parent = e.target.parentElement;
      parent.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');
      if (e.target.dataset.filter) filterRestaurants(e.target.dataset.filter);
      if (e.target.dataset.filterActivity) filterActivities(e.target.dataset.filterActivity);
      if (e.target.dataset.filterServices) filterServices(e.target.dataset.filterServices);
      return;
    }
    if (e.target && e.target.id === 'copyPass') {
      e.preventDefault();
      const t = document.getElementById('wifi-pass'); if(!t) return;
      navigator.clipboard.writeText((t.textContent||'').trim()).then(()=>{
        const n = document.getElementById('copiedMsg'); n.style.display = 'inline';
        setTimeout(()=> n.style.display='none', 1500);
      }).catch(()=> alert('Impossibile copiare'));
    }
    if (e.target && (e.target.id === 'services-toggle' || e.target.closest('#services-toggle'))) {
      const toggle = document.getElementById('services-toggle');
      const content = document.getElementById('services-content');
      toggle.classList.toggle('active');
      content.classList.toggle('expanded');
    }
  });
  (async function init() {
    if ('serviceWorker' in navigator) {
      try { await navigator.serviceWorker.register('SW (1).JS'); } catch(_) {}
    }
    initTheme();
    const lang = detectLanguage();
    const slug = getApartmentSlug();
    translatePage(lang);
    const feedbackLink = document.getElementById('feedback-link');
    if (feedbackLink) feedbackLink.href = `feedback.html?apt=${encodeURIComponent(slug)}`;
    const data = await loadApartmentData(slug);
    if (data) { renderApartment(data); showApp(); }
  })();
  </script>
</body>
</html>
