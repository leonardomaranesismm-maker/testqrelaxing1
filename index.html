<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="page-title">QRelax - Caricamento...</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:linear-gradient(135deg, #E6F7FF 0%, #F0F9FF 50%, #ffffff 100%); 
    --bg-solid:#ffffff;
    --ink:#2D3748; --muted:#6B7280; --soft:#F0F9FF; --line:#E5E7EB;
    --primary:#2D3748; --secondary:#7DD3FC; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.08);
  }
  [data-theme="dark"] {
    --bg:linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #1a202c 100%);
    --bg-solid:#1a202c;
    --ink:#f7fafc; --muted:#cbd5e0; --soft:#2d3748; --line:#4a5568; 
    --primary:#f7fafc; --secondary:#63b3ed; --shadow:0 10px 30px rgba(0,0,0,.5);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg-solid);background-image:var(--bg);min-height:100vh;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .q-container{max-width:1120px;margin:0 auto;padding:20px}
  .q-grid{display:grid;gap:14px}
  @media (min-width:768px){ .q-grid.cols-2{grid-template-columns:repeat(2,1fr)} .q-grid.cols-3{grid-template-columns:repeat(3,1fr)} }
  .hero{padding:28px 0}
  .hero-grid{display:grid;gap:16px}
  @media(min-width:768px){ .hero-grid{grid-template-columns:1fr 420px;align-items:center} }
  .hero-cover{border-radius:12px;overflow:hidden;background:#eee;height:260px}
  .q-card{background:var(--bg-solid);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;border:1px solid rgba(0,0,0,.04)}
  [data-theme="dark"] .q-card{background:var(--soft);border:1px solid var(--line)}
  .q-title{font-weight:700;margin:0 0 6px;color:var(--ink)}
  .q-text{color:var(--muted);margin:0}
  .q-small{font-size:.92rem;color:var(--muted)}
  .q-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
  .q-action{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:120px;text-align:center;border-radius:12px}
  .q-link{display:block;text-decoration:none;color:var(--ink)}
  .q-ico{width:20px;height:20px;stroke:currentColor;fill:none;display:inline-block}
  .q-ico-sm{width:16px;height:16px}
  .q-img{position:relative;aspect-ratio:16/9;background:#ddd;overflow:hidden;border-radius:10px}
  .q-img img{width:100%;height:100%;object-fit:cover}
  .q-chip{font-size:.78rem;background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:999px}
  .q-cta{display:flex;gap:8px;margin-top:12px}
  .q-btn{display:inline-flex;align-items:center;gap:8px;font-size:.9rem;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#fff;color:var(--ink);text-decoration:none;cursor:pointer}
  .q-btn-primary{background:var(--secondary);color:var(--primary);border:none;font-weight:600}
  .lang-switcher{position:fixed;top:20px;right:20px;display:flex;gap:6px;align-items:center;z-index:1000;background:rgba(255,255,255,0.95);padding:8px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
  [data-theme="dark"] .lang-switcher{background:rgba(45,55,72,0.95)}
  .theme-toggle{padding:8px;border:1px solid var(--line);background:var(--bg-solid);color:var(--ink);border-radius:8px;transition:all 0.2s;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .theme-toggle:hover{background:var(--secondary);color:var(--primary);border-color:var(--secondary)}
  .lang-btn{padding:6px 12px;border:1px solid var(--line);background:var(--bg-solid);color:var(--muted);text-decoration:none;border-radius:8px;font-size:.85rem;transition:all 0.2s;font-weight:500}
  .lang-btn.active,.lang-btn:hover{background:var(--secondary);color:var(--primary);border-color:var(--secondary)}
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:16px}
  .q-bottom{position:fixed;left:0;right:0;bottom:0;display:flex;justify-content:space-around;background:rgba(255,255,255,0.98);backdrop-filter:blur(10px);border-top:1px solid var(--line);padding:12px 10px;z-index:999;box-shadow:0 -2px 10px rgba(0,0,0,0.05)}
  [data-theme="dark"] .q-bottom{background:rgba(45,55,72,0.98)}
  .q-bottom a{display:flex;flex-direction:column;align-items:center;font-size:.75rem;color:var(--ink);text-decoration:none;gap:4px;padding:8px 16px;border-radius:12px;transition:all 0.2s}
  .q-bottom a:hover{background:var(--soft);transform:translateY(-2px)}
  .q-bottom svg{width:24px;height:24px}
  .loading{display:flex;align-items:center;justify-content:center;height:200px;color:var(--muted)}
  .error{background:#fee;border:1px solid #fcc;color:#c33;padding:20px;border-radius:8px;margin:20px 0}
  .hidden{display:none}
  .weather-widget{background:var(--soft);border:1px solid var(--line);padding:16px;border-radius:12px;margin-bottom:16px}
  .weather-info{display:flex;align-items:center;gap:12px}
  .weather-temp{font-size:2rem;font-weight:700;color:var(--primary)}
  .weather-desc{color:var(--muted);font-size:.9rem}
  .filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
  .filter-btn{padding:8px 16px;border:1px solid var(--line);background:var(--bg-solid);color:var(--muted);border-radius:20px;font-size:.85rem;cursor:pointer;transition:all 0.2s}
  .filter-btn:hover,.filter-btn.active{background:var(--secondary);color:var(--primary);border-color:var(--secondary)}
  @media(max-width:480px){
    .q-container{padding:12px}
    .hero-cover{height:180px}
    .q-action{min-height:100px}
  }
  .muted{color:var(--muted)}
  .center{display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>

<svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
  <symbol id="q-house" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
  <symbol id="q-utensils" viewBox="0 0 24 24"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3v7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></symbol>
  <symbol id="q-activity" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></symbol>
  <symbol id="q-wifi" viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0 1 14.08 0M1.42 9a16 16 0 0 1 21.16 0M8.53 16.11a6 6 0 0 1 6.95 0M12 20h.01" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></symbol>
  <symbol id="q-calendar" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
  <symbol id="q-doc" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" fill="none"/><polyline points="14 2 14 8 20 8" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
  <symbol id="q-plus" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><line x1="12" y1="8" x2="12" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="8" y1="12" x2="16" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
  <symbol id="q-phone" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></symbol>
  <symbol id="q-pin" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
  <symbol id="q-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/><line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
  <symbol id="q-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
  <symbol id="q-cloud" viewBox="0 0 24 24"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
  <symbol id="q-message" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></symbol>
  <symbol id="q-whatsapp" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" fill="currentColor"/></symbol>
</svg>

<div id="loading" class="loading">Caricamento appartamento...</div>
<div id="error" class="error hidden">Errore nel caricamento dei dati.</div>

<div id="app" class="hidden">
  <div class="q-container">
    <div class="lang-switcher">
      <button class="theme-toggle" id="theme-toggle" aria-label="Cambia tema">
        <svg class="q-ico" id="theme-icon"><use href="#q-sun"/></svg>
      </button>
      <a href="#" class="lang-btn active" data-lang="it">IT</a>
      <a href="#" class="lang-btn" data-lang="en">EN</a>
      <a href="#" class="lang-btn" data-lang="de">DE</a>
    </div>

    <header class="hero" id="main-content">
      <div id="weather-widget" class="weather-widget hidden">
        <div class="weather-info">
          <svg class="q-ico" style="width:48px;height:48px"><use href="#q-cloud"/></svg>
          <div>
            <div class="weather-temp" id="weather-temp">--°</div>
            <div class="weather-desc" id="weather-desc">Caricamento meteo...</div>
            <div class="q-small" id="weather-location"></div>
          </div>
        </div>
      </div>

      <div class="hero-grid">
        <div>
          <div class="brand">
            <svg class="brand-logo" viewBox="0 0 200 60" style="width:180px;height:auto" xmlns="http://www.w3.org/2000/svg">
              <text x="0" y="45" font-family="Inter, sans-serif" font-weight="700" font-size="48" fill="#2D3748">QR</text>
              <text x="80" y="45" font-family="Inter, sans-serif" font-weight="400" font-size="48" fill="#7DD3FC">ELAX</text>
            </svg>
          </div>
          <h1 class="q-title" id="apt-nome">Caricamento...</h1>
          <p class="q-text" id="apt-indirizzo">Caricamento indirizzo...</p>

          <div class="q-grid cols-3" style="margin-top:14px">
            <a class="q-card q-action q-link" href="#casa"><svg class="q-ico"><use href="#q-house"/></svg><div class="q-title" data-i18n="house">La casa</div><p class="q-text" data-i18n="house-desc">TV, clima, riscaldamento</p></a>
            <a class="q-card q-action q-link" href="#mangiare"><svg class="q-ico"><use href="#q-utensils"/></svg><div class="q-title" data-i18n="eat">Mangiare</div><p class="q-text" data-i18n="eat-desc">Ristoranti locali</p></a>
            <a class="q-card q-action q-link" href="#attivita"><svg class="q-ico"><use href="#q-activity"/></svg><div class="q-title" data-i18n="activities">Attività</div><p class="q-text" data-i18n="activities-desc">Esperienze e svago</p></a>
          </div>
        </div>

        <div class="hero-cover center"><img id="apt-cover" src="" alt="Appartamento" style="width:100%;height:100%;object-fit:cover"></div>
      </div>
    </header>

    <section class="q-grid cols-2" style="margin-top:18px">
      <div class="q-card">
        <div class="q-row"><svg class="q-ico"><use href="#q-wifi"/></svg><div class="q-title" data-i18n="wifi">Wi-Fi</div></div>
        <p class="q-small"><strong>SSID:</strong> <span id="wifi-ssid">—</span></p>
        <p class="q-small"><strong data-i18n="password">Password:</strong> <span id="wifi-pass">—</span></p>
        <a href="#" class="q-btn" id="copyPass" data-i18n="copy-password">Copia password</a><span class="muted" id="copiedMsg" style="display:none;margin-left:8px" data-i18n="copied">Copiata ✅</span>
      </div>

      <div class="q-card">
        <div class="q-row"><svg class="q-ico"><use href="#q-calendar"/></svg><div class="q-title" data-i18n="checkin-checkout">Check-in / Check-out</div></div>
        <p class="q-small"><span data-i18n="checkin">Check-in</span>: <span id="checkin">—</span> • <span data-i18n="checkout">Check-out</span>: <span id="checkout">—</span></p>
        <div style="margin-top:10px"><strong data-i18n="host">Host:</strong> <span id="host-info">—</span></div>
        <p class="q-small" id="checkin-note" style="margin-top:6px;font-style:italic"></p>
      </div>

      <div class="q-card">
        <div class="q-row"><svg class="q-ico"><use href="#q-doc"/></svg><div class="q-title" data-i18n="house-rules">Regole della casa</div></div>
        <div class="q-small" id="regole">—</div>
      </div>

      <div class="q-card">
        <div class="q-row"><svg class="q-ico"><use href="#q-plus"/></svg><div class="q-title" data-i18n="emergencies">Emergenze</div></div>
        <div class="q-small" id="emergenze">—</div>
      </div>
    </section>

    <section id="casa" style="margin-top:18px">
      <div class="q-title" data-i18n="house-operations">Funzionamento della casa</div>
      <div class="q-card" style="margin-top:8px">
        <div id="funzionamento" class="q-small">—</div>
      </div>
    </section>

    <section id="mangiare" style="margin-top:18px">
      <div class="q-title" data-i18n="where-eat">Dove mangiare</div>
      
      <div class="filter-bar" role="group" aria-label="Filtri ristoranti">
        <button class="filter-btn active" data-filter="all" data-i18n="filter-all">Tutti</button>
        <button class="filter-btn" data-filter="€">€</button>
        <button class="filter-btn" data-filter="€€">€€</button>
        <button class="filter-btn" data-filter="€€€">€€€</button>
        <button class="filter-btn" data-filter="vicino" data-i18n="filter-nearby">Vicino</button>
      </div>
      
      <div id="luoghi-wrap" class="q-grid cols-3" style="margin-top:10px"></div>
    </section>

    <section id="attivita" style="margin-top:18px">
      <div class="q-title" data-i18n="recommended-activities">Attività consigliate</div>
      <div id="attivita-wrap" class="q-grid cols-3" style="margin-top:10px"></div>
    </section>

    <section id="galleria" style="margin-top:18px">
      <div class="q-title" data-i18n="gallery">Galleria</div>
      <div id="gallery-wrap" class="q-grid cols-2" style="margin-top:10px"></div>
    </section>

    <section id="contatti" style="margin-top:18px;margin-bottom:120px">
      <div class="q-grid cols-2">
        <div class="q-card">
          <div class="q-title" data-i18n="contacts">Contatti</div>
          <div class="q-small" id="contact-block">—</div>
          <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap">
            <a href="https://leonardomaranesismm-maker.github.io/testqrelaxing1/feedback.html?apt=papaya" class="q-btn q-btn-primary" style="text-decoration:none;display:inline-flex;gap:8px">
              ⭐ Lascia un feedback
            </a>
            <a href="https://wa.me/393470839898" target="_blank" class="q-btn" style="text-decoration:none;display:inline-flex;gap:8px;background:#25D366;color:#fff;border:none">
              <svg style="width:18px;height:18px"><use href="#q-whatsapp"/></svg>
              WhatsApp
            </a>
          </div>
        </div>
        <div class="q-card">
          <div class="q-title" data-i18n="map">Mappa</div>
          <div style="margin-top:8px;border-radius:10px;overflow:hidden">
            <iframe id="mappa" src="" width="100%" height="280" style="border:0;display:block" allowfullscreen="" loading="lazy"></iframe>
          </div>
        </div>
      </div>
    </section>
  </div>

  <nav class="q-bottom">
    <a href="#home"><svg><use href="#q-house"/></svg><span data-i18n="home">Home</span></a>
    <a href="#casa"><svg><use href="#q-house"/></svg><span data-i18n="casa-nav">Casa</span></a>
    <a href="#mangiare"><svg><use href="#q-utensils"/></svg><span data-i18n="eat-nav">Mangiare</span></a>
    <a href="#contatti"><svg><use href="#q-message"/></svg><span data-i18n="contacts">Contatti</span></a>
  </nav>
</div>

<script>
const TRANSLATIONS = {
  it: {
    'house': 'La casa', 'house-desc': 'TV, clima, riscaldamento', 'eat': 'Mangiare', 'eat-desc': 'Ristoranti locali',
    'activities': 'Attività', 'activities-desc': 'Esperienze e svago', 'wifi': 'Wi-Fi', 'password': 'Password',
    'copy-password': 'Copia password', 'copied': 'Copiata ✅', 'checkin-checkout': 'Check-in / Check-out',
    'checkin': 'Check-in', 'checkout': 'Check-out', 'host': 'Host', 'house-rules': 'Regole della casa',
    'emergencies': 'Emergenze', 'house-operations': 'Funzionamento della casa', 'where-eat': 'Dove mangiare',
    'recommended-activities': 'Attività consigliate', 'gallery': 'Galleria', 'contacts': 'Contatti',
    'map': 'Mappa', 'maps': 'Maps', 'call': 'Chiama', 'home': 'Home', 'casa-nav': 'Casa', 'eat-nav': 'Mangiare',
    'filter-all': 'Tutti', 'filter-nearby': 'Vicino'
  },
  en: {
    'house': 'The house', 'house-desc': 'TV, air conditioning, heating', 'eat': 'Dining', 'eat-desc': 'Local restaurants',
    'activities': 'Activities', 'activities-desc': 'Experiences and entertainment', 'wifi': 'Wi-Fi', 'password': 'Password',
    'copy-password': 'Copy password', 'copied': 'Copied ✅', 'checkin-checkout': 'Check-in / Check-out',
    'checkin': 'Check-in', 'checkout': 'Check-out', 'host': 'Host', 'house-rules': 'House rules',
    'emergencies': 'Emergencies', 'house-operations': 'How the house works', 'where-eat': 'Where to eat',
    'recommended-activities': 'Recommended activities', 'gallery': 'Gallery', 'contacts': 'Contacts',
    'map': 'Map', 'maps': 'Maps', 'call': 'Call', 'home': 'Home', 'casa-nav': 'House', 'eat-nav': 'Dining',
    'filter-all': 'All', 'filter-nearby': 'Nearby'
  },
  de: {
    'house': 'Das Haus', 'house-desc': 'TV, Klimaanlage, Heizung', 'eat': 'Essen', 'eat-desc': 'Lokale Restaurants',
    'activities': 'Aktivitäten', 'activities-desc': 'Erlebnisse und Unterhaltung', 'wifi': 'Wi-Fi', 'password': 'Passwort',
    'copy-password': 'Passwort kopieren', 'copied': 'Kopiert ✅', 'checkin-checkout': 'Check-in / Check-out',
    'checkin': 'Check-in', 'checkout': 'Check-out', 'host': 'Gastgeber', 'house-rules': 'Hausregeln',
    'emergencies': 'Notfälle', 'house-operations': 'Wie das Haus funktioniert', 'where-eat': 'Wo man essen kann',
    'recommended-activities': 'Empfohlene Aktivitäten', 'gallery': 'Galerie', 'contacts': 'Kontakte',
    'map': 'Karte', 'maps': 'Maps', 'call': 'Anrufen', 'home': 'Home', 'casa-nav': 'Haus', 'eat-nav': 'Essen',
    'filter-all': 'Alle', 'filter-nearby': 'In der Nähe'
  }
};

let currentLang = 'it';
let apartmentData = null;
let allRestaurants = [];

function initTheme() {
  const saved = localStorage.getItem('qrelax-theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const theme = saved || (prefersDark ? 'dark' : 'light');
  setTheme(theme);
}

function setTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('qrelax-theme', theme);
  const icon = document.getElementById('theme-icon');
  if (icon) {
    icon.innerHTML = '<use href="#q-' + (theme === 'dark' ? 'sun' : 'moon') + '"/>';
  }
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  setTheme(next);
}

async function loadWeather(lat, lon, cityName) {
  try {
    const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=' + lat + '&longitude=' + lon + '&current_weather=true');
    const data = await response.json();
    const widget = document.getElementById('weather-widget');
    const temp = Math.round(data.current_weather.temperature);
    document.getElementById('weather-temp').textContent = temp + '°C';
    document.getElementById('weather-desc').textContent = getWeatherDescription(data.current_weather.weathercode);
    document.getElementById('weather-location').textContent = cityName;
    widget.classList.remove('hidden');
  } catch (error) {
    console.error('Errore meteo:', error);
  }
}

function getWeatherDescription(code) {
  const descriptions = {
    0: '☀️ Sereno', 1: '🌤️ Parzialmente nuvoloso', 2: '⛅ Nuvoloso', 3: '☁️ Coperto',
    45: '🌫️ Nebbia', 51: '🌦️ Pioggia leggera', 61: '🌧️ Pioggia', 80: '🌦️ Rovesci', 95: '⛈️ Temporale'
  };
  return descriptions[code] || '🌡️ Meteo';
}

function filterRestaurants(filter) {
  const cards = document.querySelectorAll('#luoghi-wrap article');
  cards.forEach(card => {
    const price = card.dataset.price;
    const distance = card.dataset.distance;
    let show = false;
    if (filter === 'all') show = true;
    else if (filter === 'vicino') show = parseInt(distance) <= 10;
    else show = price === filter;
    card.style.display = show ? 'block' : 'none';
  });
}

function getApartmentSlug() {
  const params = new URLSearchParams(window.location.search);
  return params.get('apt') || 'papaya';
}

async function loadApartmentData(slug) {
  try {
    const response = await fetch(slug + '.json');
    if (!response.ok) throw new Error('HTTP ' + response.status);
    const data = await response.json();
    apartmentData = data;
    return data;
  } catch (error) {
    console.error('Errore caricamento:', error);
    showError();
    return null;
  }
}

function showError() {
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('error').classList.remove('hidden');
}

function showApp() {
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
}

function renderApartment(data) {
  document.getElementById('page-title').textContent = data.nome || 'QRelax';
  document.getElementById('apt-nome').textContent = data.nome || '';
  document.getElementById('apt-indirizzo').textContent = data.indirizzo || '';
  document.getElementById('apt-cover').src = data.foto_copertina || '';
  document.getElementById('wifi-ssid').textContent = data.wifi_ssid || '—';
  document.getElementById('wifi-pass').textContent = data.wifi_password || '—';
  document.getElementById('checkin').textContent = data.checkin || '—';
  document.getElementById('checkout').textContent = data.checkout || '—';
  
  const hostInfo = document.getElementById('host-info');
  let hostHtml = '';
  if (data.host_telefono) hostHtml += '<a href="tel:' + data.host_telefono.replace(/\s/g,'') + '">' + data.host_telefono + '</a>';
  if (data.host_email) hostHtml += (hostHtml ? ' • ' : '') + '<a href="mailto:' + data.host_email + '">' + data.host_email + '</a>';
  hostInfo.innerHTML = hostHtml || '—';
  
  document.getElementById('checkin-note').textContent = data.checkin_note || '';
  document.getElementById('regole').innerHTML = data.regole || '—';
  document.getElementById('emergenze').innerHTML = data.emergenze || '—';
  document.getElementById('funzionamento').innerHTML = data.funzionamento || '—';
  document.getElementById('contact-block').innerHTML = hostInfo.innerHTML + (data.indirizzo ? '<p style="margin-top:16px"><strong>Indirizzo:</strong><br>' + data.indirizzo + '</p>' : '');
  
  if (data.mappa_embed) {
    document.getElementById('mappa').src = data.mappa_embed;
  }
  
  if (data.lat && data.lon) {
    loadWeather(data.lat, data.lon, data.nome);
  }
  
  renderRestaurants(data.ristoranti || []);
  renderActivities(data.attivita || []);
  renderGallery(data.galleria || []);
}

function renderRestaurants(restaurants) {
  const container = document.getElementById('luoghi-wrap');
  container.innerHTML = '';
  allRestaurants = restaurants;
  
  restaurants.forEach(r => {
    const distMatch = (r.distanza || '').match(/(\d+)/);
    const distNum = distMatch ? distMatch[1] : '999';
    const card = document.createElement('article');
    card.className = 'q-card';
    card.dataset.price = r.prezzo || '';
    card.dataset.distance = distNum;
    card.innerHTML = '<div class="q-img"><img src="' + (r.foto || '') + '" alt="' + (r.nome || '') + '" loading="lazy"></div>' +
      '<div style="padding:12px">' +
      '<div class="q-title">' + (r.nome || '') + '</div>' +
      '<div class="q-small">' + (r.prezzo ? '<span class="q-chip">' + r.prezzo + '</span>' : '') + (r.distanza ? ' • ' + r.distanza : '') + '</div>' +
      '<div class="q-small" style="margin-top:6px">' + (r.descrizione || '') + '</div>' +
      '<div class="q-cta" style="margin-top:10px">' +
      (r.telefono ? '<a class="q-btn" href="tel:' + r.telefono.replace(/\s/g,'') + '"><svg class="q-ico q-ico-sm"><use href="#q-phone"/></svg><span data-i18n="call">Chiama</span></a>' : '') +
      (r.maps ? '<a class="q-btn" href="' + r.maps + '" target="_blank"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg><span data-i18n="maps">Maps</span></a>' : '') +
      '</div></div>';
    container.appendChild(card);
  });
}

function renderActivities(activities) {
  const container = document.getElementById('attivita-wrap');
  container.innerHTML = '';
  activities.forEach(a => {
    const card = document.createElement('article');
    card.className = 'q-card';
    card.innerHTML = '<div class="q-img"><img src="' + (a.foto || '') + '" alt="' + (a.nome || '') + '" loading="lazy"></div>' +
      '<div style="padding:12px">' +
      '<div class="q-title">' + (a.nome || '') + '</div>' +
      '<div class="q-small">' + (a.distanza || '') + '</div>' +
      '<div class="q-small" style="margin-top:6px">' + (a.descrizione || '') + '</div>' +
      (a.maps ? '<div class="q-cta" style="margin-top:10px"><a class="q-btn" href="' + a.maps + '" target="_blank"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg><span data-i18n="maps">Maps</span></a></div>' : '') +
      '</div>';
    container.appendChild(card);
  });
}

function renderGallery(photos) {
  const container = document.getElementById('gallery-wrap');
  container.innerHTML = '';
  photos.forEach((photo, idx) => {
    const img = document.createElement('div');
    img.className = 'q-card q-img';
    img.innerHTML = '<img src="' + photo + '" alt="Foto appartamento ' + (idx + 1) + '" loading="lazy">';
    container.appendChild(img);
  });
}

function detectLanguage() {
  const saved = localStorage.getItem('qrelax-lang');
  if (saved && TRANSLATIONS[saved]) return saved;
  const browser = navigator.language.slice(0, 2);
  return TRANSLATIONS[browser] ? browser : 'it';
}

function translatePage(lang) {
  currentLang = lang;
  localStorage.setItem('qrelax-lang', lang);
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (TRANSLATIONS[lang] && TRANSLATIONS[lang][key]) {
      el.textContent = TRANSLATIONS[lang][key];
    }
  });
}

document.addEventListener('click', function(e) {
  if (e.target && (e.target.id === 'theme-toggle' || e.target.closest('#theme-toggle'))) {
    e.preventDefault();
    toggleTheme();
    return;
  }
  if (e.target && e.target.classList.contains('lang-btn')) {
    e.preventDefault();
    translatePage(e.target.dataset.lang);
    return;
  }
  if (e.target && e.target.classList.contains('filter-btn')) {
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    e.target.classList.add('active');
    filterRestaurants(e.target.dataset.filter);
    return;
  }
  if(e.target && e.target.id === 'copyPass'){
    e.preventDefault();
    const t = document.getElementById('wifi-pass');
    if(!t) return;
    navigator.clipboard.writeText((t.textContent||'').trim()).then(()=> {
      const n = document.getElementById('copiedMsg');
      n.style.display = 'inline';
      setTimeout(()=> n.style.display = 'none', 1500);
    }).catch(()=> alert('Impossibile copiare'));
  }
});

(async function init() {
  initTheme();
  const lang = detectLanguage();
  const slug = getApartmentSlug();
  translatePage(lang);
  const data = await loadApartmentData(slug);
  if (data) {
    renderApartment(data);
    showApp();
  }
})();
</script>

</body>
</html>
