<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title id="page-title">QRelax - Caricamento...</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#ffffff;--ink:#2D3748;--muted:#6B7280;--soft:#F0F9FF;--line:#E5E7EB;--accent:#7DD3FC;--primary:#2D3748;--secondary:#7DD3FC;--radius:14px;--shadow:0 10px 30px rgba(0,0,0,.08)}
    [data-theme="dark"]{--bg:#1a202c;--ink:#f7fafc;--muted:#a0aec0;--soft:#2d3748;--line:#4a5568;--primary:#f7fafc;--secondary:#63b3ed;--shadow:0 10px 30px rgba(0,0,0,.3)}
    html,body{margin:0;padding:0;background:linear-gradient(135deg, #e3f2fd 0%, #90caf9 50%, #42a5f5 100%);background-attachment:fixed;color:var(--ink);font-family:Inter,system-ui,sans-serif;transition:background 0.3s,color 0.3s}
    .q-container{max-width:1120px;margin:0 auto;padding:20px;position:relative}
    .q-grid{display:grid;gap:14px}
    @media(min-width:768px){.q-grid.cols-2{grid-template-columns:repeat(2,1fr)}.q-grid.cols-3{grid-template-columns:repeat(3,1fr)}}
    .hero-header{text-align:center;padding:100px 0 30px 0}
    .hero-header h1{font-size:2.5rem;font-weight:700;margin:0 0 8px;color:var(--ink)}
    .hero-header p{color:var(--muted);font-size:1.1rem;margin:0}
    .hero-cover{border-radius:16px;overflow:hidden;background:#eee;height:400px;margin:30px 0;box-shadow:var(--shadow)}
    .hero-cover img{width:100%;height:100%;object-fit:cover}
    .q-card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;border:1px solid var(--line)}
    .q-title{font-weight:700;margin:0 0 6px;color:var(--ink)}
    .q-text{color:var(--muted);margin:0}
    .q-small{font-size:.92rem;color:var(--muted)}
    .q-small a{color:var(--secondary)}
    .q-small ul{margin:0;padding-left:20px;color:var(--muted)}
    .q-small strong{color:var(--ink)}
    .q-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .q-action{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:120px;text-align:center;border-radius:12px;transition:transform 0.2s}
    .q-action:hover{transform:translateY(-4px)}
    .q-link{display:block;text-decoration:none;color:var(--ink)}
    .q-ico{width:20px;height:20px;stroke:currentColor;fill:none;display:inline-block}
    .q-ico-sm{width:16px;height:16px}
    .q-img{position:relative;aspect-ratio:16/9;background:#ddd;overflow:hidden;border-radius:10px}
    .q-img img{width:100%;height:100%;object-fit:cover}
    .q-chip{font-size:.78rem;background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:999px;color:var(--ink)}
    .q-cta{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .q-btn{display:inline-flex;align-items:center;gap:8px;font-size:.9rem;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:var(--bg);color:var(--ink);text-decoration:none;transition:all 0.2s}
    .q-btn:hover{background:var(--soft)}
    .q-btn-primary{background:var(--secondary);color:var(--primary);border:none;font-weight:600}
    .q-btn-primary:hover{opacity:0.9}
    .weather-widget{position:absolute;top:10px;left:10px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:12px;padding:12px 16px;box-shadow:0 8px 20px rgba(102,126,234,0.3);z-index:10;min-width:140px;max-width:160px;color:white;font-size:0.85rem}
    .weather-widget.hidden{display:none}
    .weather-info{display:flex;align-items:center;gap:8px}
    .weather-temp{font-size:1.4rem;font-weight:700;line-height:1}
    .weather-desc{font-size:0.75rem;opacity:0.9;margin-top:2px}
    .weather-location{font-size:0.7rem;opacity:0.8;margin-top:4px;border-top:1px solid rgba(255,255,255,0.3);padding-top:4px}
    .lang-switcher{position:fixed;top:20px;right:20px;display:flex;gap:4px;align-items:center;z-index:1000;background:var(--bg);padding:8px;border-radius:8px;box-shadow:var(--shadow);border:1px solid var(--line)}
    .theme-toggle{padding:6px 10px;border:1px solid var(--line);background:var(--bg);color:var(--muted);border-radius:6px;font-size:.8rem;transition:all 0.2s;cursor:pointer}
    .theme-toggle:hover{background:var(--secondary);color:var(--primary);border-color:var(--secondary)}
    .lang-btn{padding:6px 10px;border:1px solid var(--line);background:var(--bg);color:var(--muted);text-decoration:none;border-radius:6px;font-size:.8rem;transition:all 0.2s}
    .lang-btn.active,.lang-btn:hover{background:var(--secondary);color:var(--primary);border-color:var(--secondary)}
    .q-bottom{position:fixed;left:0;right:0;bottom:0;display:flex;justify-content:space-around;background:var(--bg);border-top:1px solid var(--line);padding:10px;z-index:999;box-shadow:0 -2px 10px rgba(0,0,0,.05)}
    .q-bottom a{display:flex;flex-direction:column;align-items:center;font-size:.72rem;color:var(--ink);text-decoration:none;padding:4px 12px;border-radius:8px;transition:background 0.2s}
    .q-bottom a:hover{background:var(--soft)}
    .q-bottom svg{width:22px;height:22px;margin-bottom:4px;stroke:var(--ink);fill:none}
    .loading{display:flex;align-items:center;justify-content:center;min-height:100vh;color:var(--muted);font-size:1.2rem}
    .error{background:#fee;border:2px solid #fcc;color:#c33;padding:40px;border-radius:12px;margin:40px;text-align:center;font-size:1.1rem}
    @media(max-width:768px){.q-container{padding:12px}.hero-header{padding:80px 0 20px 0}.hero-header h1{font-size:1.8rem}.hero-cover{height:250px;margin:20px 0}.q-action{min-height:100px}.lang-switcher{top:10px;right:10px;padding:4px;gap:2px}.lang-btn,.theme-toggle{padding:4px 8px;font-size:.75rem}.q-grid.cols-2{grid-template-columns:1fr}.q-grid.cols-3{grid-template-columns:1fr}.weather-widget{top:5px;left:5px;padding:8px 12px;min-width:120px}.weather-temp{font-size:1.2rem}}
    .hidden{display:none}
    .filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .filter-btn{padding:8px 16px;border:1px solid var(--line);background:var(--bg);color:var(--muted);border-radius:20px;font-size:.85rem;cursor:pointer;transition:all 0.2s}
    .filter-btn:hover,.filter-btn.active{background:var(--secondary);color:var(--primary);border-color:var(--secondary)}
    .scroll-container{overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;margin-top:10px;padding-bottom:10px}
    .scroll-container::-webkit-scrollbar{height:8px}
    .scroll-container::-webkit-scrollbar-track{background:var(--soft);border-radius:10px}
    .scroll-container::-webkit-scrollbar-thumb{background:var(--secondary);border-radius:10px}
    .scroll-grid{display:flex;gap:14px;min-width:min-content}
    .scroll-grid .q-card{min-width:300px;max-width:300px;flex-shrink:0}
    .whatsapp-widget{position:fixed;bottom:80px;right:20px;width:60px;height:60px;background:#25D366;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:998;transition:transform 0.3s;text-decoration:none}
    .whatsapp-widget:hover{transform:scale(1.1)}
    .whatsapp-widget svg{width:35px;height:35px}
    @media(max-width:768px){.whatsapp-widget{bottom:70px;right:15px;width:50px;height:50px}.whatsapp-widget svg{width:28px;height:28px}}
    .map-wrapper{border-radius:10px;overflow:hidden;margin-top:8px}
    .map-wrapper iframe{display:block;border:0}
    .footer-section{text-align:center;padding:48px 20px;margin-bottom:100px}
    .footer-logo svg{width:150px;height:auto}
    .footer-text{color:var(--muted);font-size:.95rem;margin-top:12px}
    .footer-powered{color:var(--muted);font-size:.8rem;margin-top:8px;font-style:italic}
    .services-toggle{width:100%;padding:16px;background:var(--soft);border:1px solid var(--line);border-radius:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:600;color:var(--ink);transition:all 0.2s}
    .services-toggle:hover{background:var(--secondary);color:var(--primary)}
    .services-toggle svg{transition:transform 0.3s}
    .services-toggle.active svg{transform:rotate(180deg)}
    .services-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease}
    .services-content.expanded{max-height:2000px}
  </style>
</head><body>

  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
    <symbol id="q-house" viewBox="0 0 24 24"><path d="M3 10L12 3l9 7v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10Z" stroke-width="2"/></symbol>
    <symbol id="q-restaurant" viewBox="0 0 24 24"><path d="M6 3v18M10 3v8a2 2 0 1 0 4 0V3M18 3v18" stroke-width="2"/></symbol>
    <symbol id="q-activity" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" stroke-width="2"/><path d="M12 7v5l4 2" stroke-width="2"/></symbol>
    <symbol id="q-wifi" viewBox="0 0 24 24"><path d="M2 8a16 16 0 0 1 20 0M5 12a11 11 0 0 1 14 0M9 16a6 6 0 0 1 6 0" stroke-width="2"/></symbol>
    <symbol id="q-calendar" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" stroke-width="2"/><path d="M8 2v4M16 2v4M3 10h18" stroke-width="2"/></symbol>
    <symbol id="q-doc" viewBox="0 0 24 24"><path d="M6 4h9l3 3v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" stroke-width="2"/></symbol>
    <symbol id="q-plus" viewBox="0 0 24 24"><path d="M12 2v20M2 12h20" stroke-width="2"/></symbol>
    <symbol id="q-phone" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.09 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.9.33 1.77.62 2.6a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6" stroke-width="2"/></symbol>
    <symbol id="q-pin" viewBox="0 0 24 24"><path d="M12 22s7-6.5 7-12a7 7 0 0 0-14 0c0 5.5 7 12 7 12Z" stroke-width="2"/><circle cx="12" cy="10" r="3" stroke-width="2"/></symbol>
    <symbol id="q-map" viewBox="0 0 24 24"><path d="M9 2L1 6v16l8-4 8 4 6-3V3l-6 3-8-4z" stroke-width="2"/><path d="M9 2v16M17 6v16" stroke-width="2"/></symbol>
    <symbol id="q-chevron-down" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" stroke-width="2"/></symbol>
    <symbol id="q-shopping" viewBox="0 0 24 24"><circle cx="9" cy="21" r="1" stroke-width="2"/><circle cx="20" cy="21" r="1" stroke-width="2"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke-width="2"/></symbol>
    <symbol id="q-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5" stroke-width="2"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke-width="2"/></symbol>
    <symbol id="q-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke-width="2"/></symbol>
  </svg>

  <div id="loading" class="loading" data-i18n="loading">‚è≥ Caricamento appartamento...</div>
  <div id="error" class="error hidden" data-i18n="error">‚ùå Errore nel caricamento dei dati. Verifica che il file papaya.json sia presente.</div>

  <div id="app" class="hidden">
    <div id="weather-widget" class="weather-widget hidden">
      <div class="weather-info">
        <div>
          <div class="weather-temp" id="weather-temp">--¬∞</div>
          <div class="weather-desc" id="weather-desc">...</div>
        </div>
      </div>
      <div class="weather-location" id="weather-location"></div>
    </div>

    <div class="lang-switcher">
      <button class="theme-toggle" id="theme-toggle" aria-label="Tema">
        <svg class="q-ico" id="theme-icon"><use href="#q-sun"/></svg>
      </button>
      <a href="#" class="lang-btn active" data-lang="it">IT</a>
      <a href="#" class="lang-btn" data-lang="en">EN</a>
      <a href="#" class="lang-btn" data-lang="de">DE</a>
    </div>

    <div class="q-container">
      <header class="hero-header">
        <h1 id="apt-nome">...</h1>
        <p id="apt-indirizzo">...</p>
      </header>

      <div class="hero-cover">
        <img id="apt-cover" src="" alt="Appartamento">
      </div>

      <div class="q-grid cols-3" style="margin-top:20px">
        <a class="q-card q-action q-link" href="#casa">
          <svg class="q-ico"><use href="#q-house"/></svg>
          <div class="q-title" data-i18n="house">La casa</div>
          <p class="q-text" data-i18n="house-desc">TV, clima</p>
        </a>
        <a class="q-card q-action q-link" href="#mangiare">
          <svg class="q-ico"><use href="#q-restaurant"/></svg>
          <div class="q-title" data-i18n="eat">Mangiare</div>
          <p class="q-text" data-i18n="eat-desc">Ristoranti</p>
        </a>
        <a class="q-card q-action q-link" href="#attivita">
          <svg class="q-ico"><use href="#q-activity"/></svg>
          <div class="q-title" data-i18n="activities">Attivit√†</div>
          <p class="q-text" data-i18n="activities-desc">Svago</p>
        </a>
      </div>

      <section class="q-grid cols-2" style="margin-top:32px">
        <div class="q-card">
          <div class="q-row"><svg class="q-ico"><use href="#q-wifi"/></svg><div class="q-title">Wi-Fi</div></div>
          <p class="q-small"><strong>SSID:</strong> <span id="wifi-ssid">‚Äî</span></p>
          <p class="q-small"><strong>Password:</strong> <span id="wifi-pass">‚Äî</span></p>
          <a href="#" class="q-btn" id="copyPass" data-i18n="copy-password">Copia password</a><span class="muted" id="copiedMsg" style="display:none;margin-left:8px">‚úÖ</span>
        </div>

        <div class="q-card">
          <div class="q-row"><svg class="q-ico"><use href="#q-calendar"/></svg><div class="q-title" data-i18n="checkinout-title">Check-in / Check-out</div></div>
          <p class="q-small"><span data-i18n="checkin-label">Check-in:</span> <span id="checkin">‚Äî</span> ‚Ä¢ <span data-i18n="checkout-label">Check-out:</span> <span id="checkout">‚Äî</span></p>
          <div style="margin-top:10px"><strong data-i18n="host-label">Host:</strong> <span id="host-info">‚Äî</span></div>
          <p class="q-small" id="checkin-note" style="margin-top:6px;font-style:italic"></p>
        </div>

        <div class="q-card">
          <div class="q-row"><svg class="q-ico"><use href="#q-doc"/></svg><div class="q-title" data-i18n="rules-title">Regole</div></div>
          <div class="q-small" id="regole">‚Äî</div>
        </div>

        <div class="q-card">
          <div class="q-row"><svg class="q-ico"><use href="#q-plus"/></svg><div class="q-title" data-i18n="emergencies-title">Emergenze</div></div>
          <div class="q-small" id="emergenze">‚Äî</div>
        </div>
      </section>

      <section id="casa" style="margin-top:18px">
        <div class="q-title" data-i18n="how-it-works">Funzionamento</div>
        <div class="q-card" style="margin-top:8px">
          <div id="funzionamento" class="q-small">‚Äî</div>
        </div>
      </section>

      <section id="mangiare" style="margin-top:18px">
        <div class="q-title" data-i18n="where-eat">Dove mangiare</div>
        <div class="filter-bar">
          <button class="filter-btn active" data-filter="all" data-i18n="filter-all">Tutti</button>
          <button class="filter-btn" data-filter="‚Ç¨">‚Ç¨</button>
          <button class="filter-btn" data-filter="‚Ç¨‚Ç¨">‚Ç¨‚Ç¨</button>
          <button class="filter-btn" data-filter="‚Ç¨‚Ç¨‚Ç¨">‚Ç¨‚Ç¨‚Ç¨</button>
          <button class="filter-btn" data-filter="vicino" data-i18n="filter-nearby">Vicino</button>
        </div>
        <div class="scroll-container">
          <div id="luoghi-wrap" class="scroll-grid"></div>
        </div>
      </section>

      <section style="margin-top:18px">
        <button class="services-toggle" id="services-toggle">
          <span><svg class="q-ico" style="margin-right:8px"><use href="#q-shopping"/></svg><span data-i18n="essential-services">Servizi Essenziali</span></span>
          <svg class="q-ico"><use href="#q-chevron-down"/></svg>
        </button>
        <div class="services-content" id="services-content">
          <div style="margin-top:14px">
            <div class="filter-bar">
              <button class="filter-btn active" data-filter-services="all" data-i18n="filter-all">Tutti</button>
              <button class="filter-btn" data-filter-services="pharmacy"><span data-i18n="pharmacy">üíä Farmacie</span></button>
              <button class="filter-btn" data-filter-services="supermarket"><span data-i18n="supermarket">üõí Supermercati</span></button>
            </div>
            <div class="scroll-container">
              <div id="services-wrap" class="scroll-grid"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="attivita" style="margin-top:18px">
        <div class="q-title" data-i18n="activities">Attivit√†</div>
        <div class="filter-bar">
          <button class="filter-btn active" data-filter-activity="all" data-i18n="filter-all">Tutti</button>
          <button class="filter-btn" data-filter-activity="outdoor">Outdoor</button>
          <button class="filter-btn" data-filter-activity="indoor">Indoor</button>
        </div>
        <div class="scroll-container">
          <div id="attivita-wrap" class="scroll-grid"></div>
        </div>
      </section>

      <section id="galleria" style="margin-top:18px">
        <div class="q-title" data-i18n="gallery">Galleria</div>
        <div id="gallery-wrap" class="q-grid cols-2" style="margin-top:10px"></div>
      </section>

      <section id="mappa" style="margin-top:18px">
        <div class="q-card">
          <div class="q-title" data-i18n="map">Mappa</div>
          <div class="map-wrapper">
            <iframe id="mappa-iframe" src="" width="100%" height="350" allowfullscreen="" loading="lazy"></iframe>
          </div>
        </div>
      </section>

      <section id="contatti" style="margin-top:18px">
        <div class="q-card">
          <div class="q-title" data-i18n="contacts">Contatti</div>
          <div class="q-small" id="contact-block">‚Äî</div>
        </div>
      </section>

      <div class="footer-section">
  <div class="footer-logo">
    <svg viewBox="0 0 220 60" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" style="stop-color:#7DD3FC;stop-opacity:1"/>
          <stop offset="100%" style="stop-color:#2D3748;stop-opacity:1"/>
        </linearGradient>
      </defs>
      <text x="0" y="45" font-family="Inter,sans-serif" font-weight="700" font-size="48" fill="url(#logoGrad)">QRelax</text>
    </svg>
  </div>
  <p class="footer-text" data-i18n="footer-thanks">Grazie per aver scelto la nostra guida digitale</p>
  <p class="footer-powered" data-i18n="footer-powered" style="margin-top:16px">Gentilmente powered by QRelax</p>
</div>

    <nav class="q-bottom">
      <a href="#home"><svg><use href="#q-house"/></svg><span data-i18n="nav-home">Home</span></a>
      <a href="#mangiare"><svg><use href="#q-restaurant"/></svg><span data-i18n="nav-eat">Mangiare</span></a>
      <a href="#attivita"><svg><use href="#q-activity"/></svg><span data-i18n="nav-activities">Attivit√†</span></a>
      <a href="#contatti"><svg><use href="#q-map"/></svg><span data-i18n="nav-contacts">Contatti</span></a>
    </nav>
  </div>

  <a href="https://wa.me/393470839898" class="whatsapp-widget" target="_blank" rel="noopener" aria-label="WhatsApp">
    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
      <path fill="white" d="M16 0c-8.837 0-16 7.163-16 16 0 2.825.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-.646-7.07-1.87l-.507-.292-5.247 1.408 1.417-5.267-.321-.525c-1.321-2.165-2.005-4.652-2.005-7.188 0-7.51 6.11-13.62 13.62-13.62s13.62 6.11 13.62 13.62-6.11 13.62-13.62 13.62zM21.305 18.421c-.327-.163-1.933-.956-2.233-1.066s-.518-.163-.736.163c-.218.327-.845 1.066-1.036 1.284s-.382.245-.709.082c-.327-.163-1.381-.509-2.632-1.626-.973-.868-1.629-1.939-1.82-2.267s-.02-.504.143-.667c.147-.146.327-.382.491-.573s.218-.327.327-.545c.109-.218.055-.409-.027-.573s-.736-1.775-1.01-2.43c-.267-.638-.538-.552-.736-.562-.191-.01-.409-.012-.627-.012s-.573.082-.873.409c-.3.327-1.145 1.12-1.145 2.731s1.172 3.167 1.336 3.385c.163.218 2.312 3.527 5.602 4.945.782.337 1.393.539 1.869.689.787.25 1.503.215 2.069.13.631-.094 1.933-.791 2.207-1.555s.273-1.42.191-1.555c-.082-.135-.3-.218-.627-.382z"/>
    </svg>
  </a><script>
  (function(){
    'use strict';
    
    let currentLang='it',apartmentData=null;
    
    const TRANS={
      it:{
        house:'La casa',
        'house-desc':'TV, clima',
        eat:'Mangiare',
        'eat-desc':'Ristoranti',
        activities:'Attivit√†',
        'activities-desc':'Svago',
        'copy-password':'Copia password',
        'checkinout-title':'Check-in / Check-out',
        'checkin-label':'Check-in:',
        'checkout-label':'Check-out:',
        'host-label':'Host:',
        'rules-title':'Regole',
        'emergencies-title':'Emergenze',
        'how-it-works':'Funzionamento',
        'where-eat':'Dove mangiare',
        'filter-all':'Tutti',
        'filter-nearby':'Vicino',
        'essential-services':'Servizi Essenziali',
        'pharmacy':'üíä Farmacie',
        'supermarket':'üõí Supermercati',
        'gallery':'Galleria',
        'map':'Mappa',
        'contacts':'Contatti',
        'nav-home':'Home',
        'nav-eat':'Mangiare',
        'nav-activities':'Attivit√†',
        'nav-contacts':'Contatti',
        'footer-thanks':'Grazie per aver scelto la nostra guida digitale',
        'footer-powered':'Gentilmente powered by QRelax',
        'loading':'‚è≥ Caricamento appartamento...',
        'error':'‚ùå Errore nel caricamento dei dati. Verifica che il file papaya.json sia presente.',
        'call':'Chiama',
        'maps':'Maps'
      },
      en:{
        house:'The house',
        'house-desc':'TV, AC',
        eat:'Dining',
        'eat-desc':'Restaurants',
        activities:'Activities',
        'activities-desc':'Fun',
        'copy-password':'Copy password',
        'checkinout-title':'Check-in / Check-out',
        'checkin-label':'Check-in:',
        'checkout-label':'Check-out:',
        'host-label':'Host:',
        'rules-title':'Rules',
        'emergencies-title':'Emergencies',
        'how-it-works':'How it works',
        'where-eat':'Where to eat',
        'filter-all':'All',
        'filter-nearby':'Nearby',
        'essential-services':'Essential Services',
        'pharmacy':'üíä Pharmacies',
        'supermarket':'üõí Supermarkets',
        'gallery':'Gallery',
        'map':'Map',
        'contacts':'Contacts',
        'nav-home':'Home',
        'nav-eat':'Dining',
        'nav-activities':'Activities',
        'nav-contacts':'Contacts',
        'footer-thanks':'Thank you for choosing our digital guide',
        'footer-powered':'Kindly powered by QRelax',
        'loading':'‚è≥ Loading apartment...',
        'error':'‚ùå Error loading data. Please verify that the papaya.json file is present.',
        'call':'Call',
        'maps':'Maps'
      },
      de:{
        house:'Das Haus',
        'house-desc':'TV, Klima',
        eat:'Essen',
        'eat-desc':'Restaurants',
        activities:'Aktivit√§ten',
        'activities-desc':'Spa√ü',
        'copy-password':'Passwort kopieren',
        'checkinout-title':'Check-in / Check-out',
        'checkin-label':'Check-in:',
        'checkout-label':'Check-out:',
        'host-label':'Gastgeber:',
        'rules-title':'Regeln',
        'emergencies-title':'Notf√§lle',
        'how-it-works':'Bedienung',
        'where-eat':'Wo essen',
        'filter-all':'Alle',
        'filter-nearby':'In der N√§he',
        'essential-services':'Wichtige Dienste',
        'pharmacy':'üíä Apotheken',
        'supermarket':'üõí Superm√§rkte',
        'gallery':'Galerie',
        'map':'Karte',
        'contacts':'Kontakte',
        'nav-home':'Home',
        'nav-eat':'Essen',
        'nav-activities':'Aktivit√§ten',
        'nav-contacts':'Kontakte',
        'footer-thanks':'Vielen Dank, dass Sie unseren digitalen Reisef√ºhrer gew√§hlt haben',
        'footer-powered':'Freundlicherweise unterst√ºtzt von QRelax',
        'loading':'‚è≥ Wohnung wird geladen...',
        'error':'‚ùå Fehler beim Laden der Daten. Bitte √ºberpr√ºfen Sie, ob die Datei papaya.json vorhanden ist.',
        'call':'Anrufen',
        'maps':'Karte'
      }
    };
    
    function initTheme(){
      const saved=localStorage.getItem('qrelax-theme');
      const theme=saved||(window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light');
      setTheme(theme);
    }
    
    function setTheme(theme){
      document.documentElement.setAttribute('data-theme',theme);
      localStorage.setItem('qrelax-theme',theme);
      const icon=document.getElementById('theme-icon');
      if(icon)icon.innerHTML=`<use href="#q-${theme==='dark'?'sun':'moon'}"/>`;
    }
    
    function toggleTheme(){
      const current=document.documentElement.getAttribute('data-theme');
      setTheme(current==='dark'?'light':'dark');
    }
    
    async function loadWeather(lat,lon,cityName){
      try{
        if(!lat||!lon)return;
        const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
        if(!r.ok)return;
        const d=await r.json();
        const temp=Math.round(d.current_weather.temperature);
        const code=d.current_weather.weathercode;
        document.getElementById('weather-temp').textContent=`${temp}¬∞C`;
        document.getElementById('weather-desc').textContent=getWeatherDesc(code);
        document.getElementById('weather-location').textContent=`üìç ${cityName}`;
        document.getElementById('weather-widget').classList.remove('hidden');
      }catch(e){console.error('Weather error:',e)}
    }
    
    function getWeatherDesc(code){
      const d={0:'‚òÄÔ∏è Sereno',1:'üå§Ô∏è Nuvoloso',2:'‚õÖ Nuvoloso',3:'‚òÅÔ∏è Coperto',45:'üå´Ô∏è Nebbia',51:'üå¶Ô∏è Pioggia',61:'üåßÔ∏è Pioggia',80:'üå¶Ô∏è Rovesci',95:'‚õàÔ∏è Temporale'};
      return d[code]||'üå°Ô∏è Meteo';
    }
    
    function filterRestaurants(filter){
      document.querySelectorAll('#luoghi-wrap article').forEach(card=>{
        const price=card.dataset.price;
        const distance=parseInt(card.dataset.distance||'999',10);
        let show=false;
        if(filter==='all')show=true;
        else if(filter==='vicino')show=distance<=10;
        else show=price===filter;
        card.style.display=show?'block':'none';
      });
    }
    
    function filterActivities(filter){
      document.querySelectorAll('#attivita-wrap article').forEach(card=>{
        card.style.display=(filter==='all'||card.dataset.type===filter)?'block':'none';
      });
    }
    
    function filterServices(filter){
      document.querySelectorAll('#services-wrap article').forEach(card=>{
        card.style.display=(filter==='all'||card.dataset.type===filter)?'block':'none';
      });
    }
    
    function getApartmentSlug(){
      const p=new URLSearchParams(window.location.search);
      return p.get('apt')||'papaya';
    }
    
    async function loadApartmentData(slug){
      try{
        const r=await fetch(`${slug}.json`);
        if(!r.ok)throw new Error(`HTTP ${r.status}`);
        const data=await r.json();
        apartmentData=data;
        return data;
      }catch(e){
        console.error('Load error:',e);
        showError();
        return null;
      }
    }
    
    function showError(){
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('error').classList.remove('hidden');
    }
    
    function showApp(){
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
    }
    
    function renderApartment(data){
      document.getElementById('page-title').textContent=data.nome||'QRelax';
      document.getElementById('apt-nome').textContent=data.nome||'';
      document.getElementById('apt-indirizzo').textContent=data.indirizzo||'';
      document.getElementById('apt-cover').src=data.foto_copertina||'';
      document.getElementById('wifi-ssid').textContent=data.wifi_ssid||'‚Äî';
      document.getElementById('wifi-pass').textContent=data.wifi_password||'‚Äî';
      if(data.sfondo){
  document.body.style.background=data.sfondo;
  document.body.style.backgroundAttachment='fixed';
}
      
      const checkinText=data.checkin&&data.checkin[currentLang]?data.checkin[currentLang]:data.checkin||'‚Äî';
      const checkoutText=data.checkout&&data.checkout[currentLang]?data.checkout[currentLang]:data.checkout||'‚Äî';
      document.getElementById('checkin').textContent=checkinText;
      document.getElementById('checkout').textContent=checkoutText;
      
      const hostInfo=document.getElementById('host-info');
      let hostHtml='';
      if(data.host_telefono)hostHtml+=`<a href="tel:${data.host_telefono.replace(/\s/g,'')}">${data.host_telefono}</a>`;
      if(data.host_email)hostHtml+=`${hostHtml?' ‚Ä¢ ':''}<a href="mailto:${data.host_email}">${data.host_email}</a>`;
      hostInfo.innerHTML=hostHtml||'‚Äî';
      
      const checkinNoteText=data.checkin_note&&data.checkin_note[currentLang]?data.checkin_note[currentLang]:data.checkin_note||'';
      document.getElementById('checkin-note').textContent=checkinNoteText;
      
      const regoleContent=data.regole&&data.regole[currentLang]?data.regole[currentLang]:data.regole||'‚Äî';
      document.getElementById('regole').innerHTML=regoleContent;
      
      const emergenzeContent=data.emergenze&&data.emergenze[currentLang]?data.emergenze[currentLang]:data.emergenze||'‚Äî';
      document.getElementById('emergenze').innerHTML=emergenzeContent;
      
      const funzionamentoContent=data.funzionamento&&data.funzionamento[currentLang]?data.funzionamento[currentLang]:data.funzionamento||'‚Äî';
      document.getElementById('funzionamento').innerHTML=funzionamentoContent;
      
      const contactBlock=document.getElementById('contact-block');
      const addressLabel=TRANS[currentLang]&&TRANS[currentLang]['address']?TRANS[currentLang]['address']:'Indirizzo:';
      contactBlock.innerHTML=hostInfo.innerHTML+(data.indirizzo?`<p style="margin-top:16px"><strong>${addressLabel}</strong><br>${data.indirizzo}</p>`:'');
      
      if(data.mappa_embed)document.getElementById('mappa-iframe').src=data.mappa_embed;
      if(data.lat&&data.lon)loadWeather(data.lat,data.lon,data.nome);
      
      renderRestaurants(data.ristoranti||[]);
      renderActivities(data.attivita||[]);
      renderServices(data.servizi||[]);
      renderGallery(data.galleria||[]);
const whatsappWidget = document.querySelector('.whatsapp-widget');
if(whatsappWidget && data.host_whatsapp) {
  const whatsappNumber = data.host_whatsapp.replace(/[\s\+\-\(\)]/g, '');
  whatsappWidget.href = `https://wa.me/${whatsappNumber}`;
}
    }
    
    function renderRestaurants(restaurants){
  const container=document.getElementById('luoghi-wrap');
  container.innerHTML='';
  const callText=TRANS[currentLang]?.call||'Chiama';
  const mapsText=TRANS[currentLang]?.maps||'Maps';
  restaurants.forEach(r=>{
    const distanzaText=r.distanza&&r.distanza[currentLang]?r.distanza[currentLang]:r.distanza||'';
    const distMatch=(distanzaText).match(/(\d+)/);
    const distNum=distMatch?distMatch[1]:'999';
    const desc=r.descrizione&&r.descrizione[currentLang]?r.descrizione[currentLang]:r.descrizione||'';
    const card=document.createElement('article');
    card.className='q-card';
    card.dataset.price=r.prezzo||'';
    card.dataset.distance=distNum;
    card.innerHTML=`
      <div class="q-img"><img src="${r.foto||''}" alt="${r.nome||''}" loading="lazy"></div>
      <div style="padding:12px">
        <div class="q-title">${r.nome||''}</div>
        <div class="q-small">
          ${r.prezzo?`<span class="q-chip">${r.prezzo}</span>`:''}
          ${distanzaText?` ‚Ä¢ ${distanzaText}`:''}
        </div>
        <div class="q-small" style="margin-top:6px">${desc}</div>
        <div class="q-cta" style="margin-top:10px">
          ${r.telefono?`<a class="q-btn" href="tel:${(r.telefono||'').replace(/\s/g,'')}"><svg class="q-ico q-ico-sm"><use href="#q-phone"/></svg>${callText}</a>`:''}
          ${r.maps?`<a class="q-btn" href="${r.maps}" target="_blank" rel="noopener"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg>${mapsText}</a>`:''}
        </div>
      </div>`;
    container.appendChild(card);
  });
}
    
  function renderActivities(activities){
  const container=document.getElementById('attivita-wrap');
  container.innerHTML='';
  const mapsText=TRANS[currentLang]?.maps||'Maps';
  activities.forEach(a=>{
    const distanzaText=a.distanza&&a.distanza[currentLang]?a.distanza[currentLang]:a.distanza||'';
    const desc=a.descrizione&&a.descrizione[currentLang]?a.descrizione[currentLang]:a.descrizione||'';
    const card=document.createElement('article');
    card.className='q-card';
    card.dataset.type=a.tipo||'outdoor';
    card.innerHTML=`
      <div class="q-img"><img src="${a.foto||''}" alt="${a.nome||''}" loading="lazy"></div>
      <div style="padding:12px">
        <div class="q-title">${a.nome||''}</div>
        <div class="q-small">${distanzaText}</div>
        <div class="q-small" style="margin-top:6px">${desc}</div>
        ${a.maps?`<div class="q-cta" style="margin-top:10px"><a class="q-btn" href="${a.maps}" target="_blank" rel="noopener"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg>${mapsText}</a></div>`:''}
      </div>`;
    container.appendChild(card);
  });
}
    
    function renderServices(services){
  const container=document.getElementById('services-wrap');
  container.innerHTML='';
  const callText=TRANS[currentLang]?.call||'Chiama';
  const mapsText=TRANS[currentLang]?.maps||'Maps';
  services.forEach(s=>{
    const distanzaText=s.distanza&&s.distanza[currentLang]?s.distanza[currentLang]:s.distanza||'';
    const card=document.createElement('article');
    card.className='q-card';
    card.dataset.type=s.tipo||'pharmacy';
    card.innerHTML=`
      <div style="padding:12px">
        <div class="q-title">${s.nome||''}</div>
        <div class="q-small">
          ${s.tipo==='pharmacy'?'üíä':'üõí'} ${distanzaText}
        </div>
        <div class="q-small" style="margin-top:6px">${s.indirizzo||''}</div>
        <div class="q-cta" style="margin-top:10px">
          ${s.telefono?`<a class="q-btn" href="tel:${(s.telefono||'').replace(/\s/g,'')}"><svg class="q-ico q-ico-sm"><use href="#q-phone"/></svg>${callText}</a>`:''}
          ${s.maps?`<a class="q-btn" href="${s.maps}" target="_blank" rel="noopener"><svg class="q-ico q-ico-sm"><use href="#q-pin"/></svg>${mapsText}</a>`:''}
        </div>
      </div>`;
    container.appendChild(card);
  });
}
    
    function renderGallery(photos){
      const container=document.getElementById('gallery-wrap');
      container.innerHTML='';
      photos.forEach((photo,idx)=>{
        const img=document.createElement('div');
        img.className='q-card q-img';
        img.innerHTML=`<img src="${photo}" alt="Foto ${idx+1}" loading="lazy">`;
        container.appendChild(img);
      });
    }
    
    function detectLanguage(){
      const saved=localStorage.getItem('qrelax-lang');
      if(saved&&TRANS[saved])return saved;
      const browser=navigator.language.slice(0,2);
      return TRANS[browser]?browser:'it';
    }
    
    function translatePage(lang){
      currentLang=lang;
      localStorage.setItem('qrelax-lang',lang);
      document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active',b.dataset.lang===lang));
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key=el.dataset.i18n;
        if(TRANS[lang]&&TRANS[lang][key])el.textContent=TRANS[lang][key];
      });
      if(apartmentData)renderApartment(apartmentData);
    }
    
    document.addEventListener('click',e=>{
      if(e.target&&(e.target.id==='theme-toggle'||e.target.closest('#theme-toggle'))){
        e.preventDefault();toggleTheme();return;
      }
      if(e.target&&e.target.classList.contains('lang-btn')){
        e.preventDefault();translatePage(e.target.dataset.lang);return;
      }
      if(e.target&&e.target.classList.contains('filter-btn')){
        const parent=e.target.parentElement;
        parent.querySelectorAll('.filter-btn').forEach(btn=>btn.classList.remove('active'));
        e.target.classList.add('active');
        if(e.target.dataset.filter)filterRestaurants(e.target.dataset.filter);
        if(e.target.dataset.filterActivity)filterActivities(e.target.dataset.filterActivity);
        if(e.target.dataset.filterServices)filterServices(e.target.dataset.filterServices);
        return;
      }
      if(e.target&&e.target.id==='copyPass'){
        e.preventDefault();
        const t=document.getElementById('wifi-pass');
        if(!t)return;
        navigator.clipboard.writeText((t.textContent||'').trim()).then(()=>{
          const n=document.getElementById('copiedMsg');
          n.style.display='inline';
          setTimeout(()=>n.style.display='none',1500);
        }).catch(()=>alert('Impossibile copiare'));
      }
      if(e.target&&(e.target.id==='services-toggle'||e.target.closest('#services-toggle'))){
        const toggle=document.getElementById('services-toggle');
        const content=document.getElementById('services-content');
        toggle.classList.toggle('active');
        content.classList.toggle('expanded');
      }
    });
    
    (async function init(){
      if('serviceWorker' in navigator){
        try{await navigator.serviceWorker.register('sw.js')}catch(_){}
      }
      initTheme();
      const lang=detectLanguage();
      const slug=getApartmentSlug();
      translatePage(lang);
      const data=await loadApartmentData(slug);
      if(data){renderApartment(data);showApp()}
    })();
  })();
  </script>
</body>
</html>
